## 产品设计

1. 产品流程概览（权益生命周期）

```
flowchart TD
    A[创建权益包（Campaign/Entitlement）] --> B[配置发码策略<br/>类型=license/coupon/...]
    B --> C[生成码批次/即时发码]
    C --> D[发放渠道：API / Webhook / 后台导出]
    D --> E[用户获取激活码]
    E --> F[客户端提交激活码 + 绑定信息]
    F --> G[营销服务校验码、检查配额、状态流转]
    G --> H[根据类型执行后置动作<br/>如绑定设备/授予服务]
    H --> I[记录生命周期 & 统计仪表盘]
```

- 权益包定义“面向产品”“有效期”“限量/配额”“绑定策略”等。
- 发码可以批量预生成，也可以付费后即时生成。
- 核心在于统一的校验/绑定逻辑 + 生命周期追踪。

2. 付费到激活的时序（整合支付、发码、客户端）

```
sequenceDiagram
    participant Buyer as 用户/客户端
    participant Pay as 支付网关(AliPay/Stripe)
    participant Marketing as marketing-service
    participant License as 授权/绑定模块

    Buyer->>Pay: 发起支付
    Pay-->>Marketing: 支付成功回调(订单ID/用户信息)
    Marketing->>Marketing: 生成或分配激活码<br/>更新码批次状态
    Marketing-->>Buyer: 通过通知/SDK/邮件发码
    Buyer->>Marketing: 在客户端提交激活码 + 设备信息
    Marketing->>Marketing: 校验码有效性/配额/过期
    Marketing->>License: 执行绑定逻辑（写入 device/account）
    License-->>Marketing: 返回授权结果
    Marketing-->>Buyer: 激活成功/失败反馈
```

- 可插拔“后置动作”：有的权益只需减库存；license 则需绑定设备。
- 整个流程复用已有支付/回调机制，仅在营销服务中补齐激活逻辑。

3. 激活码冷/热流程（对标苹果模式再做微创新
```
flowchart TD
    subgraph 冷批次（预生成）
        P1[批量生成 codes<br/>维护库存] --> P2[人工/后台导出]
        P2 --> P3[分发给渠道或独立开发者]
    end

    subgraph 热生成（自动发码）
        R1[监听订单事件] --> R2[即时生成 code]
        R2 --> R3[自动推送给用户]
    end

    P3 & R3 --> C1[用户兑换入口]
    C1 --> C2[校验 + 绑定 + 授权]
```

- 预生成可应对苹果那种“固定数量、有限期”模式 [1]。
- 即时发码可满足 V2EX 中提到的“付费自动发放 + SDK 验证 + 仪表盘统计”的需求


### 结论与下一步
模型上，我们已抽象为“通用权益包 + 码批次 + 兑换绑定”三层，能覆盖 App 激活、订阅权益、优惠券等场景。
接下来可以围绕 marketing-service 落地以下微创新：
多权益类型：license/coupon/subscription 等配置化。
统一兑换 API + SDK：减少独立开发者接入成本。
多渠道发放：订单回调、后台批量、第三方 Webhook。
生命周期监控：配额、失效、绑定、风控都在一个仪表盘内可视化。
这样既复用苹果成熟的兑换码思路，也比单一平台更灵活，后续再叠加 user-growth-service 的裂变/增长实验，即可形成一套对外可复用的 SaaS 级激活码解决方案。